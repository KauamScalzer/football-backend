<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edi√ß√µes do Campeonato</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border: 1px solid #ddd;
        }
        button {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Edi√ß√µes do Campeonato</h1>

    <!-- Criar Edi√ß√£o -->
    <section>
        <h2>Criar Edi√ß√£o</h2>
        <form id="create-edition-form">
            <input type="number" id="year" placeholder="Ano" required>
            
            <!-- Campo Select para o time campe√£o -->
            <select id="team-select" required>
                <option value="">Selecione o Time Campe√£o</option>
            </select>

            <button type="submit" title="Adicionar Edi√ß√£o">+</button>
        </form>
    </section>

    <!-- Listar Edi√ß√µes -->
    <section>
        <h2>Edi√ß√µes</h2>
        <table>
            <thead>
                <tr>
                    <th>Ano</th>
                    <th>Time Campe√£o</th>
                    <th>Campeonato</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="editions-list"></tbody>
        </table>
    </section>

    <a href="index.html">Voltar</a>

    <script>
        // Pega o campeonatoId da URL
        const urlParams = new URLSearchParams(window.location.search);
        const championshipId = urlParams.get('championshipId');

        document.addEventListener('DOMContentLoaded', () => {
            if (championshipId) {
                fetchEditions(championshipId); // Carregar as edi√ß√µes do campeonato
                fetchTeams(); // Carregar os times dispon√≠veis para o select
            }
        });

        // Fun√ß√£o para listar edi√ß√µes
        async function fetchEditions(championshipId) {
            const response = await fetch(`/team-championship/${championshipId}`);
            const editions = await response.json();
            const list = document.getElementById('editions-list');
            list.innerHTML = ''; // Limpar a lista

            editions.forEach(edition => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${edition.year}</td>
                    <td>${edition.team.name}</td>
                    <td>${edition.championship.name}</td>
                    <td>
                        <button onclick="editEdition(${edition.id}, ${edition.year}, '${edition.team.id}', '${edition.team.name}')" title="Editar Edi√ß√£o">‚úèÔ∏è</button>
                        <button onclick="deleteEdition(${edition.id})" title="Excluir Edi√ß√£o">üóëÔ∏è</button>
                    </td>
                `;
                list.appendChild(row);
            });
        }

        // Fun√ß√£o para listar os times no select
        async function fetchTeams() {
            const response = await fetch('/team'); // Endpoint para pegar a lista de times
            const teams = await response.json();
            const teamSelect = document.getElementById('team-select');
            teamSelect.innerHTML = '<option value="">Selecione o Time Campe√£o</option>'; // Limpar as op√ß√µes existentes

            teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.id; // ID do time
                option.textContent = team.name; // Nome do time
                teamSelect.appendChild(option);
            });
        }

        // Criar edi√ß√£o
        document.getElementById('create-edition-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            const year = document.getElementById('year').value;
            const teamId = document.getElementById('team-select').value;
            
            if (!teamId) {
                alert("Por favor, selecione um time campe√£o.");
                return;
            }

            await fetch(`/team-championship`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ year, teamId, championshipId }),
            });

            document.getElementById('year').value = ''; // Limpar o campo
            document.getElementById('team-select').value = ''; // Limpar o select
            fetchEditions(championshipId); // Atualizar a lista
        });

        // Editar edi√ß√£o
        async function editEdition(id, currentYear, currentTeamId, currentTeamName) {
            const newYear = prompt(`Editar Edi√ß√£o: ${currentYear}`, currentYear);
            const teamSelect = document.getElementById('team-select');
            // Selecionar o time atual
            teamSelect.value = currentTeamId;

            const newTeamId = teamSelect.value;

            if (newYear && newTeamId) {
                await fetch(`/team-championship/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ year: newYear, teamId: newTeamId, championshipId }),
                });
                fetchEditions(championshipId); // Atualizar a lista
            }
        }

        // Excluir edi√ß√£o
        async function deleteEdition(id) {
            if (confirm('Tem certeza que deseja excluir esta edi√ß√£o?')) {
                await fetch(`/team-championship/${id}`, { method: 'DELETE' });
                fetchEditions(championshipId); // Atualizar a lista
            }
        }
    </script>
</body>
</html>
